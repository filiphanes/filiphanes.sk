<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
</head>
<body>
    <video id="qrScanner" width="100%" height="480"></video>
    <div id="log"></div>

    <script>
    const qrScanner = document.getElementById('qrScanner');
    const logDiv = document.getElementById('log');
    
    async function scanQRCode() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            qrScanner.srcObject = stream;
            const scanner = new Instascan.Scanner({ video: qrScanner });
            scanner.addListener('scan', sendQRCodeDataToAPI);
            Instascan.Camera.getCameras().then(cameras => {
                if (cameras.length > 0) {
                    scanner.start(cameras[0]);
                } else {
                    reject('No cameras found.');
                }
            });
        } catch (error) {
            logError('Error scanning QR code: ' + error);
        }
    }
    
    function sendQRCodeDataToAPI(receiptId) {
        // Display scanned QR code data
        log('Scanned QR code: ' + receiptId);
            
        fetch(`https://blocky.hanes.workers.dev/${receiptId}`)
        .then(response => response.text())
        .then(log)
        .catch(error => {
          logError('Error: ' + error);
        });
    }
    
    function log(message) {
        const message = document.createElement('p');
        message.textContent = message;
        logDiv.insertBefore(message, logDiv.firstChild);
    }
    
    function logError(message) {
        const message = document.createElement('p');
        message.style.color = 'red';
        message.textContent = message;
        logDiv.insertBefore(message, logDiv.firstChild);
    }
    
    window.addEventListener('load', scanQRCode);
    </script>
</body>
</html>
